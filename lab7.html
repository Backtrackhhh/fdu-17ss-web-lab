<html lang="en" dir="ltr">
<head>
    <meta charset="utf-8">
    <title>lab07</title>
    <style>
        form{
            text-align: center;}
        select,button{
            height: 30px;
            border-radius: 5px;
            width: 300px;
        }
        button{
            display: none;
        }
        .tbCreate{
            display: none;
        }
        .aboutTb input{
            width: 140px;
            margin-right: 8px;
        }
        table{
            margin-left: auto;
            margin-right: auto;
        }
         th{
            background-color: grey;
            color: whitesmoke;
            min-width: 40px;
        }
        td{
            padding: 0 0.5em;
        }
        input{
            margin-top: 10px;
            margin-right: 10px;
            height:30px;
        }
        .infor{
            color: red;
            margin-left:500px ;
        }

    </style>
</head>
<body>
<section>
    <form action="">
        <select name="" id="select1">
            <option value = "selectOne">Select one</option>
            <option value = "createTable">Create table</option>
            <option value = "addRow">Add row</option>
            <option value = "delRow">Delete row</option>
            <option value = "delTable" title="WARNING: You cannot undo this action!">Delete table</option>
        </select>
        <div class="tbCreate">
            <div class="aboutTb">
                <input type="text" placeholder="Table Name" id="tbName">
                <input type="number" placeholder="Columns Numbers" id="colNumber">
            </div>
            <div class="aboutColumn">

            </div>
        </div><br>
        <button>commit</button><br>
        <select name="" id="select2">
            <option value="select">Select</option>
        </select>
    </form>
    <div class="infor">

    </div>
    <div class="lay-table">

    </div>
</section>
</body>
<script>
    let button = document.getElementsByTagName("button")[0];
    let colNumber = document.getElementById("colNumber");
    let colbox = document.querySelector(".aboutColumn");
    let hidtd = document.querySelector(".tbCreate");
    let hidden = document.querySelector(".lay-table");
    let msg = document.querySelector(".infor");
    let select2 = document.getElementById("select2");
    let select1 = document.getElementById("select1");
    let showtb = document.querySelector(".aboutTb");
    let columnsInput = [];
    let tables = [];

    colNumber.onchange = function(){
        let number = parseInt(colNumber.value);
        if(number <= 0){
            return false;
        }else {
            button.style.display = "inline";

            colbox.style.display = "block";
            showInput(number);
        }
    };


    function showInput(number, ths = []){
        while(colbox.hasChildNodes()) //judge for loop
        {
            colbox.removeChild(colbox.firstChild);
        }

        for(let i = 0; i < number; i++){
            columnsInput[i] = document.createElement("input");
            columnsInput[i].type = "text";
            columnsInput[i].placeholder = ths[i]? ths[i].innerHTML : "Attribute";
            columnsInput[i].style.width = 140 + "px";
            columnsInput[i].style.height = "30px";
            colbox.appendChild(columnsInput[i]);
        }
    }

    function add(){
        let numbers = 0;
        if(select2.value !== "select")
            numbers = tables[select2.value].getElementsByTagName("th").length;
        else {
            return;
        }
        showInput(numbers,numbers = tables[select2.value].getElementsByTagName("th"));
    }

    select1.onchange = function(){
        switch (this.value) {
            case "selectOne":
                button.style.display = "none";
                hidtd.style.display = "none";
                msg.innerHTML = "";
                break;
            case "createTable":
                showtb.getElementsByTagName("input")[0].value = "";
                showtb.getElementsByTagName("input")[1].value = "";
                hidtd.style.display = "block";
                showtb.style.display = "block";
                colbox.style.display = "none";
                msg.innerHTML = "";
                break;
            case "addRow":
                showtb.style.display = "none";
                colbox.style.display = "block";
                add();
                msg.innerHTML = "";
                break;
            case "delRow":
                showtb.style.display = "none";
                colbox.style.display = "block";
                if(select2.value !== "select")
                    showInput(tables[select2.value].getElementsByTagName("th").length,tables[select2.value].getElementsByTagName("th"));
                msg.innerHTML = "";
                break;
            case "delTable":
                hidtd.style.display = "none";
                msg.innerHTML = "WARNING: You cannot undo this action!";
                if(select2.value === "select"){
                    msg.innerHTML = '';
                }
                break;
        }
    };

    select2.onchange = function(){
        show(tables[select2.value]);
        if(select2.value === "select")
            return;
        if(select1.value === "addRow" || select1.value === "delRow"){
            showInput(tables[select2.value].getElementsByTagName("th").length, numbers = tables[select2.value].getElementsByTagName("th"));
        }
    };

    function show(table){
        if(hidden.firstChild)
            hidden.removeChild(hidden.firstChild);
        if(select2.value === "select")
            return;
        hidden.appendChild(table);
    }

    button.onclick = function(){
        if(select1.value === "createTable"){
            let tbName = document.getElementById("tbName").value || "tableName";
            lock(tbName);
            tbName = inCase(tbName);
            tables[tbName] = document.createElement("table");
            let thead = document.createElement("thead");
            for(let i = 0; i < parseInt(colNumber.value); i++){
                let th = document.createElement("th");
                th.innerHTML = columnsInput[i].value || "Attribute";
                thead.appendChild(th);
            }
            tables[tbName].appendChild(thead);
            show(tables[tbName]);

            showtb.getElementsByTagName("input")[0].value = "";
            showtb.getElementsByTagName("input")[1].value = "";
            showInput(0);

        }else if(select1.value === "addRow"){
            let r1 = false;
            let tr = document.createElement("tr");
            for(let i = 0; i < tables[select2.value].getElementsByTagName("th").length; i++){
                let td = document.createElement("td");
                td.innerHTML = columnsInput[i].value;
                td.className = classes[tables[select2.value].getElementsByTagName("tr").length % 2];
                tr.appendChild(td);
                if(td.innerHTML !== "")
                    r1 = true;
            }
            if(!r1){
                return false;
            }
            tables[select2.value].appendChild(tr);
            showInput(tables[select2.value].getElementsByTagName("th").length,tables[select2.value].getElementsByTagName("th"));
        }else if(select1.value === "delTable"){
            unlock();
            if(select2.value === "select"){
                msg.innerHTML = '';
            }
        }else if(select1.value === "delRow"){
            if(select2.value === "select")
                return false;

            let trs = tables[select2.value].getElementsByTagName("tr");

            let r2 = true;
            for(let i = 0; i < trs.length; i++){
                let ok = true;
                let tds = trs[i].getElementsByTagName("td");

                for(let k = 0; k < tds.length; k++){

                    if(!r2){
                        tds[k].className = classes[1 - classes.indexOf(tds[k].className)]
                    }

                    if(tds[k].innerHTML !== colbox.getElementsByTagName("input")[k].value
                        && colbox.getElementsByTagName("input")[k].value && r2){
                        ok = false;
                        break;
                    }

                }

                if(ok && r2){
                    tables[select2.value].removeChild(trs[i]);
                    showInput(tables[select2.value].getElementsByTagName("th").length,tables[select2.value].getElementsByTagName("th"));
                    r2 = false;
                    i--;
                }
            }
            showInput(tables[select2.value].getElementsByTagName("th").length,tables[select2.value].getElementsByTagName("th"));
        }
        return false;
    };


    function lock(optionValue){

        let option = document.createElement("option");
        select2.appendChild(option);
        option.innerHTML = optionValue;
        option.value = inCase(optionValue);
        option.selected = true;
    }


    function unlock(){
        let options = select2.getElementsByTagName("option");
        if(select2.value === "select")
            return;
        for(let option of options){
            if(option.selected){
                select2.removeChild(option);
                tables[option.value] = "";
                if(hidden.firstChild)
                    hidden.removeChild(hidden.firstChild);
                if(select2.getElementsByTagName("option")[1]){
                    select2.getElementsByTagName("option")[1].selected = true;
                    show(tables[select2.getElementsByTagName("option")[1].value]);
                }
                return;
            }
        }
    }


    function inCase(tableName){
        let count = 0;
        for(let i in tables){
            if(i.replace( /\d+/,'') === tableName.replace( /\d+/,''))
                count++;
        }
        return tableName + count;
    }


</script>
</html>
